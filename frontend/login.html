<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CV Screening — Login</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <style>
    body{font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
  </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-800 text-slate-100 p-4">

  <div class="w-full max-w-md bg-slate-900/60 rounded-xl p-6 shadow-lg">
    <h1 class="text-xl font-semibold mb-4 text-center">Sign in to CV Screening</h1>

    <div id="alreadySignedIn" class="hidden mb-4 p-3 rounded bg-emerald-900/40 border border-emerald-700 text-sm">
      You’re already signed in as <span id="who"></span>.
      <button id="goToApp" class="mt-2 w-full bg-emerald-600 hover:bg-emerald-500 rounded py-2">Continue to app</button>
      <button id="logOut" class="mt-2 w-full bg-slate-700 hover:bg-slate-600 rounded py-2">Sign out</button>
    </div>

    <div id="authForms">
      <label class="block text-sm mb-2">Email</label>
      <input id="email" type="email" class="w-full mb-3 p-2 rounded bg-slate-800 border border-slate-700" placeholder="you@example.com" />

      <label class="block text-sm mb-2">Password</label>
      <input id="password" type="password" class="w-full mb-4 p-2 rounded bg-slate-800 border border-slate-700" placeholder="••••••••" />

      <button id="signIn" class="w-full bg-blue-600 hover:bg-blue-500 rounded py-2 mb-2">Sign in</button>
      <button id="signUp" class="w-full bg-slate-700 hover:bg-slate-600 rounded py-2 mb-4">Create account</button>

      <div class="text-center text-xs text-slate-400 mb-2">— or —</div>
      <button id="guest" class="w-full bg-gray-600 hover:bg-gray-500 rounded py-2">Continue as guest (Anonymous)</button>

      <div id="msg" class="mt-3 text-sm text-rose-300"></div>
    </div>
  </div>

<script>
  // Same Firebase config as index.html
  const FIREBASE_CONFIG = {
    apiKey:     "AIzaSyBU3W41QoplQ1XuJbB-Q7K8qHmG-v5eeE0",
    authDomain: "cv-screening-40a27.firebaseapp.com",
    projectId:  "cv-screening-40a27",
    appId:      "1:694775477157:web:2bfa3934cd74a646b42e4c"
  };
  firebase.initializeApp(FIREBASE_CONFIG);
  const auth = firebase.auth();

  const $ = (id) => document.getElementById(id);
  const msg = (t) => { $("msg").textContent = t || ""; };

  auth.onAuthStateChanged((user) => {
    if (user) {
      // DO NOT auto-redirect — show a “Continue” so the page doesn’t flash away.
      $("authForms").classList.add("hidden");
      $("alreadySignedIn").classList.remove("hidden");
      $("who").textContent = user.email || (user.isAnonymous ? "Anonymous" : user.uid);
    } else {
      $("alreadySignedIn").classList.add("hidden");
      $("authForms").classList.remove("hidden");
      msg("");
    }
  });

  $("signIn").onclick = async () => {
    msg("");
    try {
      const email = $("email").value.trim();
      const pass  = $("password").value;
      await auth.signInWithEmailAndPassword(email, pass);
      location.replace("index.html");
    } catch (e) { msg(e.message || String(e)); }
  };

  $("signUp").onclick = async () => {
    msg("");
    try {
      const email = $("email").value.trim();
      const pass  = $("password").value;
      await auth.createUserWithEmailAndPassword(email, pass);
      location.replace("index.html");
    } catch (e) { msg(e.message || String(e)); }
  };

  $("guest").onclick = async () => {
    msg("");
    try {
      await auth.signInAnonymously();
      location.replace("index.html");
    } catch (e) { msg(e.message || String(e)); }
  };

  $("goToApp").onclick = () => location.replace("index.html");
  $("logOut").onclick   = async () => { try { await auth.signOut(); } catch(e){} msg("Signed out. You can sign in now."); };
</script>
</body>
</html>
